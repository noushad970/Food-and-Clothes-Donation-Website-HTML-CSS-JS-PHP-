<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Organizations</title>

  <link rel="stylesheet" href="../css/organizations.css" />
  <link rel="stylesheet" href="../css/header.css" />
  <link rel="stylesheet" href="../css/message.css" />
  
</head>
<body>
    <header>
        <section style="background:rgb(0, 153, 255)">
            <!-- Top Navigation Bar -->
        <div class="top-navbar">
          <img id="profilePic" src="" alt="Profile" style="width: 50px; height: 50px; border-radius: 50%;">
            <a href="home.html">üè† Home</a>
            <a href="create-post.html">Create a Post</a>
            <a href="posts.html">Posts</a>
            <a href="profile.html">Profile</a>
            <a href="about.html">üë§ About us</a>
            <!-- Add more buttons here -->
          </div>
        </section>
    </header>

    







  <h2>Registered Organizations</h2>

  <div class="search-box">
    <input type="text" id="searchInput" placeholder="Search by address...">
    <button onclick="searchOrganizations()">Search</button>
  </div>

  <div id="orgList"></div>

  <div class="pagination">
    <button onclick="loadNextPage()">Next Page</button>
  </div>

  

  <script src="../js/message.js"></script>
  <script>
    let currentPage = 1;
    let currentSearch = "";

    function fetchOrganizations(page = 1, search = "") {
      fetch(`../php/organization.php?page=${page}&search=${encodeURIComponent(search)}`)
        .then(res => res.json())
        .then(data => {
          const list = document.getElementById('orgList');
          if (page === 1) list.innerHTML = ''; // Clear on new search
          if (data.length === 0 && page === 1) {
            list.innerHTML = "<p>No organizations found.</p>";
          } else {
            data.forEach(org => {
              const div = document.createElement('div');
              div.className = "org-card";
              div.style.display = "flex";
              div.style.justifyContent = "space-between";
              div.style.alignItems = "center";
            
              const info = `
                <div style="flex: 1;">
                  <h3>${org.org_name}</h3>
                  <p><strong>Address:</strong> ${org.org_location}</p>
                  <p><strong>Phone:</strong> ${org.org_phone}</p>
                </div>
              `;

          const message_us=`<button class="messageOrgBtn" data-receiver-id="<?= $organization['user_id'] ?>">
              üí¨ Message Us
          </button>
          `;
              const image = `
                <div style="width: 400px; height: 250px; overflow: hidden; border-radius: 10px; margin-left: 20px;">
                  <img src="../uploads/${org.org_image}" style="width: 100%; height: 100%; object-fit: cover;" />
                </div>
              `;
            
              div.innerHTML = info +message_us+ image;
              list.appendChild(div);
            });
            
          }
        });
    }

    function searchOrganizations() {
      currentSearch = document.getElementById("searchInput").value;
      currentPage = 1;
      fetchOrganizations(currentPage, currentSearch);
    }

    function loadNextPage() {
      currentPage++;
      fetchOrganizations(currentPage, currentSearch);
    }

    // Load initial data
    fetchOrganizations();
  </script>
  <script>
    fetch('../php/get_user_data.php')
      .then(res => res.json())
      .then(data => {
        const pic = data.profile_picture ? `../uploads/${data.profile_picture}` : '../assets/default.jpg';
        document.getElementById('profilePic').src = pic;
      });
  </script>
</body>
</html>
